---
title: "Gesture Recognition"
author: "Liva Dogan"
date: "11/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
x_acc = read.table("uWaveGestureLibrary_X_TRAIN")
y_acc = read.table("uWaveGestureLibrary_Y_TRAIN")
z_acc = read.table("uWaveGestureLibrary_Z_TRAIN")
```

### 1. Introduction

This report is written to observe the acceleration data of some gestures (named as x_acc, y_acc, z_acc), visualizing them and finally proposing two different representation methods in order to summarize the data. To be able to visualize the instances, we need to get location values. We can reach this information via average speed, which can be calculated by cumulative sum of acceleration. These manipulations can be done by following code lines:

```{r, include=TRUE, results='hide', warning=FALSE, message=FALSE}
velocity = function(dat)
{
  for (i in 3:ncol(dat)) 
  {
    dat[,i] = dat[,i] + dat[,i-1]
  }
  return(dat)
}

x_vel = velocity(x_acc)
y_vel = velocity(y_acc)
z_vel = velocity(z_acc)

location = function(dat)
{
  dat2 = dat
  dat2[,2] = dat[,2]/2
  for (i in 3:ncol(dat)) 
  {
    dat2[,i] = dat2[,i-1] + ((dat[,i] + dat[,i-1]) / 2)
  }
  return(dat2)
}

x_loc = location(x_vel)
y_loc = location(y_vel)
z_loc = location(z_vel)
```

### 2. Visualization

Since we have converted the acceleration data into location information, plotting these points will give us the gesture. A 3D scatter plot can be very useful in order to show points on xyz coordinate space. However, if we use a scatter plot, the time cannot be shown on any axis. Thus, we can use different colors to show the beginning and the end of the drawn gesture. The 3D scatter plots of 8 different gestures can be seen below:

```{r echo=FALSE}
library(scatterplot3d)

groupvector = c(rep(1, 40), rep(2, 40), rep(3, 40), rep(4, 40), rep(5, 40), rep(6, 40),
                rep(7, 40), rep(8, 36)) #used for plot colors

sample_class_1 = cbind(groupvector, t(x_loc[17,]), t(y_loc[17,]), t(z_loc[17,]))
sample_class_1 = sample_class_1[-1,]
scatterplot3d(sample_class_1[,2:4], pch = 16, color = sample_class_1[,1],
              main = "Gesture 1",
              xlim = c(min(sample_class_1), max(sample_class_1)),
              ylim = c(min(sample_class_1), max(sample_class_1)),
              zlim = c(min(sample_class_1), max(sample_class_1)),
              angle = 60, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_2 = cbind(groupvector, t(x_loc[811,]), t(y_loc[811,]), t(z_loc[811,]))
sample_class_2 = sample_class_2[-1,]
scatterplot3d(sample_class_2[,2:4], pch = 16, color = sample_class_2[,1],
              main = "Gesture 2",
              xlim = c(min(sample_class_2), max(sample_class_2)),
              ylim = c(min(sample_class_2), max(sample_class_2)),
              zlim = c(min(sample_class_2), max(sample_class_2)),
              angle = 340, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_3 = cbind(groupvector, t(x_loc[13,]), t(y_loc[13,]), t(z_loc[13,]))
sample_class_3 = sample_class_3[-1,]
scatterplot3d(sample_class_3[,2:4], pch = 16, color = sample_class_3[,1],
              main = "Gesture 3",
              xlim = c(min(sample_class_3), max(sample_class_3)),
              ylim = c(min(sample_class_3), max(sample_class_3)),
              zlim = c(min(sample_class_3), max(sample_class_3)),
              angle = 290, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_4 = cbind(groupvector, t(x_loc[5,]), t(y_loc[5,]), t(z_loc[5,]))
sample_class_4 = sample_class_4[-1,]
scatterplot3d(sample_class_4[,2:4], pch = 16, color = sample_class_4[,1],
              main = "Gesture 4",
              xlim = c(min(sample_class_4), max(sample_class_4)),
              ylim = c(min(sample_class_4), max(sample_class_4)),
              zlim = c(min(sample_class_4), max(sample_class_4)),
              angle = 290, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_5 = cbind(groupvector, t(x_loc[2,]), t(y_loc[2,]), t(z_loc[2,]))
sample_class_5 = sample_class_5[-1,]
scatterplot3d(sample_class_5[,2:4], pch = 16, color = sample_class_5[,1],
              main = "Gesture 5",
              xlim = c(min(sample_class_5), max(sample_class_5)),
              ylim = c(min(sample_class_5), max(sample_class_5)),
              zlim = c(min(sample_class_5), max(sample_class_5)),
              angle = 30, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_6 = cbind(groupvector, t(x_loc[1,]), t(y_loc[1,]), t(z_loc[1,]))
sample_class_6 = sample_class_6[-1,]
scatterplot3d(sample_class_6[,2:4], pch = 16, color = sample_class_6[,1],
              main = "Gesture 6",
              xlim = c(min(sample_class_6), max(sample_class_6)),
              ylim = c(min(sample_class_6), max(sample_class_6)),
              zlim = c(min(sample_class_6), max(sample_class_6)),
              angle = 30, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_7 = cbind(groupvector, t(x_loc[271,]), t(y_loc[271,]), t(z_loc[271,]))
sample_class_7 = sample_class_7[-1,]
scatterplot3d(sample_class_7[,2:4], pch = 16, color = sample_class_7[,1],
              main = "Gesture 7",
              xlim = c(min(sample_class_7), max(sample_class_7)),
              ylim = c(min(sample_class_7), max(sample_class_7)),
              zlim = c(min(sample_class_7), max(sample_class_7)),
              angle = 345, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_8 = cbind(groupvector, t(x_loc[858,]), t(y_loc[858,]), t(z_loc[858,]))
sample_class_8 = sample_class_8[-1,]
scatterplot3d(sample_class_8[,2:4], pch = 16, color = sample_class_8[,1],
              main = "Gesture 8",
              xlim = c(min(sample_class_8), max(sample_class_8)),
              ylim = c(min(sample_class_8), max(sample_class_8)),
              zlim = c(min(sample_class_8), max(sample_class_8)),
              angle = 345, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")
```

In the graphs, black part shows the beginning and grey part shows the end of gesture. As it is seen, the plots are quite similar to the given figure even though there are slight differences. The reason of this is that we are trying to observe a 3D scatter plot on a 2D screen. If we had the opportunity to observe the plots on a 3D space, we could achieve the exact view of gestures.

### 3. Representation

#### A. Piecewise Aggregate Approximation (PAA)

In this method, we divide the time series into equal time segments and use mean values of these time segments instead of using information per time. PAA may be a good approach for this problem since the coordinates do not change sharply in shorter time intervals. For our problem, we can use 9 equal time segments:

```{r, include=TRUE, results='hide', warning=FALSE, message=FALSE}
paa = function(dat)
{
  dat2 = dat[, 1:10]
  for (i in 1:896) 
  {
    for (j in 2:10) 
    {
      dat2[i, j] = mean(as.numeric(dat[i, (35*j-68):(35*j-34)]))
    }
  }
  return(dat2)
}

x_loc_paa = paa(x_loc)
y_loc_paa = paa(y_loc)
z_loc_paa = paa(z_loc)
```

```{r echo=FALSE}
sample_class_1_paa = cbind(t(x_loc_paa[17,]), t(y_loc_paa[17,]), t(z_loc_paa[17,]))
sample_class_1_paa = sample_class_1_paa[-1,]
scatterplot3d(sample_class_1_paa, pch = 16, color = 1:9,
              main = "Gesture 1",
              xlim = c(min(sample_class_1_paa), max(sample_class_1_paa)),
              ylim = c(min(sample_class_1_paa), max(sample_class_1_paa)),
              zlim = c(min(sample_class_1_paa), max(sample_class_1_paa)),
              angle = 60, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_2_paa = cbind(t(x_loc_paa[811,]), t(y_loc_paa[811,]), t(z_loc_paa[811,]))
sample_class_2_paa = sample_class_2_paa[-1,]
scatterplot3d(sample_class_2_paa, pch = 16, color = 1:9,
              main = "Gesture 2",
              xlim = c(min(sample_class_2_paa), max(sample_class_2_paa)),
              ylim = c(min(sample_class_2_paa), max(sample_class_2_paa)),
              zlim = c(min(sample_class_2_paa), max(sample_class_2_paa)),
              angle = 340, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_3_paa = cbind(t(x_loc_paa[13,]), t(y_loc_paa[13,]), t(z_loc_paa[13,]))
sample_class_3_paa = sample_class_3_paa[-1,]
scatterplot3d(sample_class_3_paa, pch = 16, color = 1:9,
              main = "Gesture 3",
              xlim = c(min(sample_class_3_paa), max(sample_class_3_paa)),
              ylim = c(min(sample_class_3_paa), max(sample_class_3_paa)),
              zlim = c(min(sample_class_3_paa), max(sample_class_3_paa)),
              angle = 290, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_4_paa = cbind(t(x_loc_paa[5,]), t(y_loc_paa[5,]), t(z_loc_paa[5,]))
sample_class_4_paa = sample_class_4_paa[-1,]
scatterplot3d(sample_class_4_paa, pch = 16, color = 1:9,
              main = "Gesture 4",
              xlim = c(min(sample_class_4_paa), max(sample_class_4_paa)),
              ylim = c(min(sample_class_4_paa), max(sample_class_4_paa)),
              zlim = c(min(sample_class_4_paa), max(sample_class_4_paa)),
              angle = 290, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_5_paa = cbind(t(x_loc_paa[2,]), t(y_loc_paa[2,]), t(z_loc_paa[2,]))
sample_class_5_paa = sample_class_5_paa[-1,]
scatterplot3d(sample_class_5_paa, pch = 16, color = 1:9,
              main = "Gesture 5",
              xlim = c(min(sample_class_5_paa), max(sample_class_5_paa)),
              ylim = c(min(sample_class_5_paa), max(sample_class_5_paa)),
              zlim = c(min(sample_class_5_paa), max(sample_class_5_paa)),
              angle = 30, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_6_paa = cbind(t(x_loc_paa[1,]), t(y_loc_paa[1,]), t(z_loc_paa[1,]))
sample_class_6_paa = sample_class_6_paa[-1,]
scatterplot3d(sample_class_6_paa, pch = 16, color = 1:9,
              main = "Gesture 6",
              xlim = c(min(sample_class_6_paa), max(sample_class_6_paa)),
              ylim = c(min(sample_class_6_paa), max(sample_class_6_paa)),
              zlim = c(min(sample_class_6_paa), max(sample_class_6_paa)),
              angle = 30, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_7_paa = cbind(t(x_loc_paa[271,]), t(y_loc_paa[271,]), t(z_loc_paa[271,]))
sample_class_7_paa = sample_class_7_paa[-1,]
scatterplot3d(sample_class_7_paa, pch = 16, color = 1:9,
              main = "Gesture 7",
              xlim = c(min(sample_class_7_paa), max(sample_class_7_paa)),
              ylim = c(min(sample_class_7_paa), max(sample_class_7_paa)),
              zlim = c(min(sample_class_7_paa), max(sample_class_7_paa)),
              angle = 345, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")

sample_class_8_paa = cbind(t(x_loc_paa[858,]), t(y_loc_paa[858,]), t(z_loc_paa[858,]))
sample_class_8_paa = sample_class_8_paa[-1,]
scatterplot3d(sample_class_8_paa, pch = 16, color = 1:9,
              main = "Gesture 8",
              xlim = c(min(sample_class_8_paa), max(sample_class_8_paa)),
              ylim = c(min(sample_class_8_paa), max(sample_class_8_paa)),
              zlim = c(min(sample_class_8_paa), max(sample_class_8_paa)),
              angle = 345, xlab = "X-Axis", ylab = "Y-Axis", zlab = "Z-Axis")
```

The graphs above are the 3D scatter plots of mean values. If we compare them to the graphs drawn before, we can easily say that the shapes are almost the same, which concludes that using segment means instead of individual positions is not a bad approach.

#### B. Symbolic Aggregate Approximation (SAX)

We can use SAX as second representation approach. In this method, besides dividing time into segments, we also divide the position values into equal intervals. In our case, we can divide mean values instead of inidividual position values to deal with fewer numbers. So, the following function will do the necessary divisions:

```{r, include=TRUE, results='hide', warning=FALSE, message=FALSE}
sax = function(dat)
{
  dat2 = dat
  for (i in 1:896) 
  {
    for (j in 2:10) 
    {
      if ((-30000)<=dat[i,j] & dat[i,j]<(-24000))
      {
        dat2[i,j] = "A"
      }
      else if ((-24000)<=dat[i,j] & dat[i,j]<(-18000))
      {
        dat2[i,j] = "B"
      }
      else if ((-18000)<=dat[i,j] & dat[i,j]<(-12000))
      {
        dat2[i,j] = "C"
      }
      else if ((-12000)<=dat[i,j] & dat[i,j]<(-6000))
      {
        dat2[i,j] = "D"
      }
      else if ((-6000)<=dat[i,j] & dat[i,j]<(0))
      {
        dat2[i,j] = "E"
      }
      else if ((0)<=dat[i,j] & dat[i,j]<(6000))
      {
        dat2[i,j] = "F"
      }
      else if ((6000)<=dat[i,j] & dat[i,j]<(12000))
      {
        dat2[i,j] = "G"
      }
      else if ((12000)<=dat[i,j] & dat[i,j]<(18000))
      {
        dat2[i,j] = "H"
      }
      else if ((18000)<=dat[i,j] & dat[i,j]<(24000))
      {
        dat2[i,j] = "I"
      }
      else if ((24000)<=dat[i,j] & dat[i,j]<(30000))
      {
        dat2[i,j] = "J"
      }
    }
  }
  return(dat2)
}

x_loc_sax = sax(x_loc_paa)
y_loc_sax = sax(y_loc_paa)
z_loc_sax = sax(z_loc_paa)
```

The range of means goes from -30000 to 30000. So, we can divide this range into 10 equal intervals and assign each interval a letter. This method makes reading time series easier for human users because we are only looking at letters that are showing the approximate location at that time. After applying this, final shape of data tables will look like below:

```{r echo=TRUE}
head(x_loc_sax, 5)
head(y_loc_sax, 5)
head(z_loc_sax, 5)
```

### 4. Conclusion

To summarize, we can comment that SAX makes the data less confusing because of the letter notation. However, because of the nature of gesture movements, the positions of the mover in a very short time interval do not change significantly. So, with an appropriate choosing of time interval, PAA method can be a good approximation method for recognizing new gestures.

To reach the RMD file, please click [here](https://bu-ie-48b.github.io/fall21-livadogann/files/homework1.Rmd)



